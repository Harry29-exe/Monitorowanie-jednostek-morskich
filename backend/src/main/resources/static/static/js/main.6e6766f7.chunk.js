(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{119:function(t,e,n){},120:function(t,e,n){"use strict";n.r(e);var c=n(48),s=n(0),i=n.n(s),r=n(35),o=n.n(r),a=n(7),h=n(13),j=n(68),u=n(129),l=n(131),b=n(130),d=n(69),O=n(70),x=n(49),p=n(29),f=n(30),m=function(){function t(e,n,c){Object(p.a)(this,t),this.ships=void 0,this.x=void 0,this.y=void 0,this.ships=e,this.x=n,this.y=c}return Object(f.a)(t,[{key:"toMarkerString",value:function(){var t,e="",n=0,c=Object(x.a)(this.ships);try{for(c.s();!(t=c.n()).done;){var s=t.value;if(e=e.concat("(".concat(s.name,", ").concat(s.mmsi,")")),++n>5){e=e.concat("...and more");break}}}catch(i){c.e(i)}finally{c.f()}return e}}]),t}();var g=function(){function t(e,n,c,s){Object(p.a)(this,t),this.fromX=void 0,this.fromY=void 0,this.toX=void 0,this.toY=void 0,this.fromX=e,this.fromY=n,this.toX=c,this.toY=s}return Object(f.a)(t,[{key:"minX",get:function(){return Math.min(this.fromX,this.toX)}},{key:"maxX",get:function(){return Math.max(this.fromX,this.toX)}},{key:"minY",get:function(){return Math.min(this.fromY,this.toY)}},{key:"maxY",get:function(){return Math.max(this.fromY,this.toY)}}]),t}(),v=n(14);function y(t){var e=1===t?10:t>20?16:t>5?14:12,n=document.createElement("div");return n.style.borderRadius="100%",n.style.marginLeft="".concat(-e/2,"px"),n.style.marginTop="".concat(-e/2,"px"),n.style.width="".concat(e,"px"),n.style.height="".concat(e,"px"),n.style.background=1===t?"blue":t>20?"rgb(115, 50, 168, 0.6)":t>5?"rgb(201, 209, 48, 0.8)":"rgb(48, 209, 61, 0.95)",n.style.border="1px solid black",n}var w=n(127),k=n(128),S=n(4),I=function(t){var e=t.marker;return Object(S.jsx)(w.a,{position:[e.y,e.x],icon:new v.DivIcon({html:y(e.ships.length),iconSize:[0,0]}),children:Object(S.jsx)(k.a,{children:Object(S.jsxs)(j.f,{maxH:"100px",overflowY:"auto",children:[Object(S.jsx)(j.a,{fontSize:"14px",children:"Ships in region:"}),Object(S.jsx)(j.a,{w:"100%",borderBottom:"2px solid black"}),e.ships.map((function(t){return Object(S.jsxs)("div",{children:[Object(S.jsx)(j.a,{children:t.name}),Object(S.jsx)(j.a,{children:t.mmsi}),Object(S.jsx)(j.a,{w:"100%",borderBottom:"2px solid black"})]},t.mmsi)}))]})})})},C=function(t){var e=Object(s.useState)(),n=Object(a.a)(e,2),c=n[0],i=n[1],r=Object(s.useState)([]),o=Object(a.a)(r,2),h=o[0],p=o[1],f=Object(s.useState)(1200),v=Object(a.a)(f,2),y=v[0],w=v[1],k=Object(s.useState)(600),C=Object(a.a)(k,2),L=C[0];C[1];return Object(s.useEffect)((function(){if(c){var e=function(){var e=c.getZoom(),n=c.getBounds(),s=n.getNorthWest(),i=n.getSouthEast(),r=new g(s.lng,s.lat,i.lng,i.lat);p(e>=10?function(t,e){var n,c=10*Math.abs(Math.abs(e.fromX)-Math.abs(e.toX)),s=10*Math.abs(Math.abs(e.fromY)-Math.abs(e.toY)),i=e.minX<0?e.minX+c:e.minX-c,r=e.maxX<0?e.maxX-c:e.maxX+c,o=e.minY<0?e.minY+s:e.minY-s,a=e.maxY<0?e.maxY-s:e.maxY+s,h=[],j=Object(x.a)(t);try{for(j.s();!(n=j.n()).done;){var u=n.value;u.currentLocation.x>i&&u.currentLocation.x<r&&u.currentLocation.y>o&&u.currentLocation.y<a&&h.push(new m([u],u.currentLocation.x,u.currentLocation.y))}}catch(l){j.e(l)}finally{j.f()}return h}(t.ships,r):function(t,e){var n,c=Math.abs(Math.abs(e.fromX)-Math.abs(e.toX))/20,s=Math.abs(Math.abs(e.fromY)-Math.abs(e.toY))/20,i=[],r=Object(x.a)(t);try{var o=function(){var t=n.value,e=i.filter((function(e){return Math.abs(Math.abs(e.x)-Math.abs(t.currentLocation.x))<=c&&Math.abs(Math.abs(e.y)-Math.abs(t.currentLocation.y))<=s}));e.length>0?e[0].ships.push(t):i.push(new m([t],t.currentLocation.x,t.currentLocation.y))};for(r.s();!(n=r.n()).done;)o()}catch(a){r.e(a)}finally{r.f()}return i}(t.ships,r))};return c.addEventListener("zoomend",e),function(){c&&c.removeEventListener("zoomend",e)}}}),[c,t.ships]),Object(S.jsxs)(j.b,{zIndex:1,w:"100%",h:"100%",p:10,children:[Object(S.jsx)(j.a,{h:L+"px",w:y+"px",children:Object(S.jsxs)(u.a,{center:[59.9138,10.7522],zoom:10,scrollWheelZoom:!0,style:{height:"100%",width:"100%"},whenCreated:function(t){return i(t)},children:[Object(S.jsx)(l.a,{attribution:'\xa9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),!!t.traces&&t.traces.length>0&&t.traces.map((function(t){return Object(S.jsx)(b.a,{pathOptions:{color:"blue"},positions:t.map((function(t){return[t.y,t.x]}))})})),h.map((function(t){return Object(S.jsx)(I,{marker:t},t.toMarkerString())}))]})}),Object(S.jsxs)(j.f,{pos:"absolute",bottom:0,right:0,minW:"300px",minH:"100px",borderTopLeftRadius:"md",bg:"teal.600",p:4,children:[Object(S.jsxs)(j.d,{children:[Object(S.jsx)(j.a,{children:"Map width"}),Object(S.jsx)(d.a,{onChange:function(t,e){console.log(t),w(e)},children:Object(S.jsx)(d.b,{})})]}),Object(S.jsx)(O.a,{onClick:function(){},children:"Change map size"})]})]})},L="http://localhost:8080";var M=function(){var t=Object(s.useState)([]),e=Object(a.a)(t,2),n=e[0],c=e[1];return Object(s.useEffect)((function(){fetch("".concat(L,"/ships/all")).then((function(t){return t.json()})).then((function(t){c(t)}))}),[]),Object(S.jsx)(C,{ships:n,traces:[]})},T=n(8),E=n(75),Y=n(71),z=n(72);var B=function(){var t=Object(T.e)(),e=t.isOpen,n=t.onOpen,c=t.onClose,i=Object(s.useState)(""),r=Object(a.a)(i,2),o=r[0],h=r[1],u=Object(s.useState)(""),l=Object(a.a)(u,2),b=l[0],d=l[1],x=Object(T.b)(!1),p=Object(a.a)(x,2),f=p[0],m=p[1],g=Object(T.b)(!1),v=Object(a.a)(g,2),y=v[0],w=v[1];return Object(S.jsxs)(S.Fragment,{children:[Object(S.jsx)(O.a,{onClick:n,children:"Register"}),Object(S.jsxs)(E.a,{isOpen:e,onClose:c,children:[Object(S.jsx)(E.g,{}),Object(S.jsx)(E.d,{children:f?Object(S.jsxs)(S.Fragment,{children:[Object(S.jsx)(z.a,{status:"success",children:"You have been successfully registered"}),Object(S.jsx)(O.a,{onClick:c,children:"Take me to login"})]}):Object(S.jsxs)(S.Fragment,{children:[Object(S.jsx)(E.c,{onClick:c}),Object(S.jsx)(E.f,{children:Object(S.jsx)(j.b,{children:"Register"})}),Object(S.jsx)(E.b,{children:Object(S.jsxs)(j.f,{py:3,spacing:6,children:[Object(S.jsx)(Y.a,{placeholder:"Enter username",onChange:function(t){return h(t.target.value)}}),Object(S.jsx)(Y.a,{type:"password",placeholder:"Enter password",onChange:function(t){return d(t.target.value)}}),y&&Object(S.jsx)(z.a,{status:"error",children:"We could not register your account try with different username/password"})]})}),Object(S.jsx)(E.e,{children:Object(S.jsx)(O.a,{onClick:function(){(function(t,e){return fetch("".concat(L,"/register"),{body:JSON.stringify({username:t,password:e}),headers:{"Content-Type":"application/json"},method:"post"}).then((function(t){return t.status})).catch((function(){return 400}))})(o,b).then((function(t){t<300&&t>=200?m.on():w.on()}))},size:"md",children:"Register"})})]})})]})]})},X=function(t){var e=Object(T.e)(),n=e.isOpen,c=e.onOpen,i=e.onClose,r=Object(s.useState)(""),o=Object(a.a)(r,2),h=o[0],u=o[1],l=Object(s.useState)(""),b=Object(a.a)(l,2),d=b[0],x=b[1],p=Object(T.b)(!1),f=Object(a.a)(p,2),m=f[0],g=f[1];return Object(S.jsxs)(S.Fragment,{children:[Object(S.jsx)(O.a,{onClick:c,size:"lg",bg:"teal.600",children:"Login"}),Object(S.jsxs)(E.a,{isOpen:n,onClose:i,children:[Object(S.jsx)(E.g,{}),Object(S.jsxs)(E.d,{children:[Object(S.jsx)(E.c,{onClick:i}),Object(S.jsx)(E.f,{children:Object(S.jsx)(j.b,{children:"Login"})}),Object(S.jsx)(E.b,{children:Object(S.jsxs)(j.f,{py:3,spacing:6,children:[Object(S.jsx)(Y.a,{placeholder:"Enter username",onChange:function(t){return u(t.target.value)}}),Object(S.jsx)(Y.a,{type:"password",placeholder:"Enter password",onChange:function(t){return x(t.target.value)}}),m&&Object(S.jsx)(z.a,{status:"error",children:"We could not log you, check you username and password"})]})}),Object(S.jsx)(E.e,{children:Object(S.jsxs)(j.d,{children:[Object(S.jsx)(B,{}),Object(S.jsx)(O.a,{size:"md",onClick:function(){(function(t,e){return console.log(t,e),fetch("".concat(L,"/login"),{body:JSON.stringify({username:t,password:e}),headers:{"Content-Type":"application/json"},method:"post"}).then((function(e){return e.status<=200&&e.status<300?{status:e.status,username:t,authToken:e.headers.get("Authorization")}:{status:e.status}})).catch((function(){return{status:400}}))})(h,d).then((function(e){e.status<300&&e.status>=200&&void 0!==e.username&&void 0!==e.authToken?(i(),t.onLogin({username:e.username,authToken:e.authToken})):g.on()}))},children:"Login"})]})})]})]})]})};var F=function(){function t(e,n,c,s,i){Object(p.a)(this,t),this.type=void 0,this.destination=void 0,this.currentLocation=void 0,this.mmsi=void 0,this.name=void 0,this.type=e,this.destination=i,this.currentLocation=n,this.mmsi=c,this.name=s}return Object(f.a)(t,null,[{key:"from",value:function(e){var n=e.shipDTO;return new t(n.shipType,e.lastLocation,n.mmsi,n.name,void 0)}}]),t}(),N=n(74),A=n(21),G=n(73),D=i.a.createContext({});function V(t,e){return fetch("".concat(L,"/ships/history/").concat(e),{headers:{Authorization:t},method:"post"}).then((function(t){return t.json()}))}var H,_=function(t){var e=Object(T.e)(),n=e.isOpen,c=e.onOpen,i=e.onClose,r=Object(s.useState)(),o=Object(a.a)(r,2),h=o[0],u=o[1],l=Object(s.useContext)(D),b=Object(s.useContext)(J),d=t.ship;return Object(S.jsxs)(S.Fragment,{children:[Object(S.jsx)(O.b,{icon:Object(S.jsx)(A.c,{}),"aria-label":"show details",bg:"teal.700",onClick:c,children:"Open Modal"}),Object(S.jsxs)(E.a,{isOpen:n,onClose:i,size:"2xl",children:[Object(S.jsx)(E.g,{}),Object(S.jsxs)(E.d,{bg:"teal.700",children:[Object(S.jsxs)(E.f,{children:[d.name,Object(S.jsx)(E.c,{})]}),Object(S.jsx)(E.b,{children:Object(S.jsxs)(j.f,{w:"100%",children:[Object(S.jsxs)(j.d,{w:"100%",children:[Object(S.jsx)(j.a,{flexGrow:4,children:"Name:"}),Object(S.jsx)(j.a,{flexGrow:0,children:d.name})]}),Object(S.jsxs)(j.d,{w:"100%",children:[Object(S.jsx)(j.a,{flexGrow:4,children:"MMSI:"}),Object(S.jsx)(j.a,{flexGrow:0,children:d.mmsi})]}),Object(S.jsxs)(j.d,{w:"100%",children:[Object(S.jsx)(j.a,{flexGrow:4,children:"Ship type:"}),Object(S.jsx)(j.a,{flexGrow:0,children:d.shipType})]}),Object(S.jsxs)(j.d,{w:"100%",children:[Object(S.jsx)(j.a,{flexGrow:4,children:"Is still tracked:"}),Object(S.jsx)(j.a,{flexGrow:0,children:d.stillTracked})]}),Object(S.jsx)(j.d,{py:4,w:"100%",justifyContent:"flex-end",children:Object(S.jsx)(O.a,{onClick:function(){var e,n;l.auth&&(e=l.auth.authToken,n=t.ship.publicId,fetch("".concat(L,"/ships/").concat(n),{method:"delete",headers:{Authorization:e}}).then((function(t){return t.status<300&&t.status>=200}))).then((function(t){t&&(i(),b.initShipFetch())}))},children:"Delete"})}),Object(S.jsx)(j.c,{}),Object(S.jsx)(O.a,{onClick:function(){l.auth&&V(l.auth.authToken,t.ship.publicId).then((function(t){return u(t.history)}))},children:"Show history"}),h&&Object(S.jsx)(j.f,{children:h.map((function(t){return Object(S.jsxs)(j.d,{w:"100%",children:[Object(S.jsxs)(j.a,{w:"25%",children:["X: ",t.x]}),Object(S.jsxs)(j.a,{w:"25%",children:["Y: ",t.y]}),Object(S.jsxs)(j.a,{w:"50%",children:["Date: ",t.time]})]})}))})]})})]})]})]})};!function(t){t[t.VISIBLE=0]="VISIBLE",t[t.NOT_VISIBLE=1]="NOT_VISIBLE",t[t.CHANGING=2]="CHANGING"}(H||(H={}));var P=function(t){var e=Object(s.useState)(H.NOT_VISIBLE),n=Object(a.a)(e,2),c=n[0],i=n[1],r=t.ship;return Object(S.jsxs)(j.d,{spacing:10,alignSelf:"flex-start",w:"100%",py:4,borderBottom:"2px solid",borderColor:"rgb(255,255,255,0.3)",children:[Object(S.jsxs)(j.f,{alignItems:"flex-start",flexGrow:4,children:[Object(S.jsxs)("span",{children:["Ship name: ",r.name]}),Object(S.jsxs)("span",{children:["Ship mmsi: ",r.mmsi]})]}),Object(S.jsxs)(j.d,{children:[Object(S.jsx)(G.a,{label:"stop tracking",children:Object(S.jsx)(_,{ship:t.ship})}),Object(S.jsx)(G.a,{label:"show history",children:Object(S.jsx)(O.b,{"aria-label":"",bg:"teal.700",icon:c===H.NOT_VISIBLE?Object(S.jsx)(A.f,{}):c===H.VISIBLE?Object(S.jsx)(A.g,{}):Object(S.jsx)(A.e,{}),onClick:function(){if(i(H.CHANGING),c===H.VISIBLE)t.hide(r.publicId).then((function(t){return i(t===K.OK?H.NOT_VISIBLE:H.VISIBLE)}));else{if(c!==H.NOT_VISIBLE)return;t.show(r.publicId).then((function(t){return i(t===K.OK?H.VISIBLE:H.NOT_VISIBLE)}))}}})})]})]},r.publicId)},W=n(53);var K,R=function(t){var e=Object(s.useContext)(D),n=Object(T.b)(!1),c=Object(a.a)(n,2),i=c[0],r=c[1],o=Object(s.useState)(""),h=Object(a.a)(o,2),u=h[0],l=h[1];return Object(S.jsxs)(j.f,{w:"100%",borderBottom:"2px solid",borderColor:"rgb(255,255,255,0.3)",pb:5,children:[Object(S.jsx)(Y.a,{placeholder:"enter ship mmsi",onChange:function(t){return l(t.target.value)}}),i&&Object(S.jsxs)(z.a,{status:"success",borderRadius:"md",bg:"green.500",children:[Object(S.jsx)(z.b,{}),"Successfully added new ship",Object(S.jsx)(W.a,{onClick:r.toggle,position:"absolute",right:"8px",top:"8px"})]}),Object(S.jsxs)(O.a,{px:2,w:"100%",bg:"teal.700",onClick:function(){e.auth&&function(t,e){return fetch("".concat(L,"/ships/tracking/").concat(e),{method:"post",headers:{Authorization:t}}).then((function(t){return t.status}))}(e.auth.authToken,Number.parseInt(u)).then((function(e){e>=200&&e<300&&(r.on(),t.initShipsFetch())}))},children:["Add ship to track",Object(S.jsx)(A.d,{fontSize:"25px"})]})]})},J=i.a.createContext({}),Z=function(t){var e=Object(T.b)(!0),n=Object(a.a)(e,2),c=n[0],s=n[1],i=Object(N.a)([250,350,400]);return Object(S.jsx)(J.Provider,{value:t,children:Object(S.jsxs)(j.d,{h:"100%",spacing:0,pos:"absolute",top:0,zIndex:5,shadow:"0 0 10px 4px black",left:c?0:"-".concat(i,"px"),transition:"left 0.5s",children:[Object(S.jsxs)(j.f,{bg:"teal.600",px:4,h:"100%",py:6,w:"".concat(i,"px"),pos:"relative",minH:"100%",maxH:"100%",overflowY:"auto",children:[Object(S.jsx)(R,{initShipsFetch:t.initShipFetch}),t.ships.map((function(e){return Object(S.jsx)(P,{ship:e,show:t.show,hide:t.hide})}))]}),Object(S.jsx)(j.b,{onClick:function(){return s.toggle()},_hover:{cursor:"pointer"},p:2,pb:40,fontSize:"16px",w:"30px",h:"100%",bg:"teal.700",children:c?Object(S.jsx)(A.a,{}):Object(S.jsx)(A.b,{})})]})})},U=function(){function t(e,n){Object(p.a)(this,t),this.lastLocation=void 0,this.shipDTO=void 0,this.visible=!0,this.history=void 0,this.displayHistory=!1,this.isUnderModifications=!1,this.lastLocation=e,this.shipDTO=n}return Object(f.a)(t,[{key:"fetchHistory",value:function(){var t=this,e=this.shipDTO.publicId;return fetch("".concat(L,"/ships/history/").concat(e)).then((function(t){return t.json()})).then((function(e){return t.history=e}))}}]),t}();!function(t){t[t.OK=0]="OK",t[t.FAIL=1]="FAIL"}(K||(K={}));var $=function(){var t=Object(s.useState)([]),e=Object(a.a)(t,2),n=e[0],c=e[1],i=Object(T.b)(!1),r=Object(a.a)(i,2),o=r[0],h=r[1],u=Object(s.useContext)(D),l=u.auth,b=function(){return c(n.map((function(t){return t})))};Object(s.useEffect)((function(){var t;l&&(t=l.authToken,fetch("".concat(L,"/ships/tracked-ships"),{headers:{Authorization:t}}).then((function(t){return t.json()})).catch((function(t){return console.log(t)}))).then((function(t){t?c(t.map((function(t){return new U(t.lastLocation,t.shipDTO)}))):console.log("Body is broken")}))}),[l,o]);var d=n.filter((function(t){return t.displayHistory&&!!t.history})).map((function(t){return t.history}));return Object(S.jsx)(j.d,{m:0,p:0,h:"100%",w:"100%",pos:"relative",children:l?Object(S.jsxs)(S.Fragment,{children:[Object(S.jsx)(Z,{ships:n.map((function(t){return t.shipDTO})),show:function(t){var e=n.filter((function(e){return e.shipDTO.publicId===t}));return e.length>0&&l?V(l.authToken,e[0].shipDTO.publicId).then((function(t){e[0].history=t.history,e[0].displayHistory=!0,b()})).then((function(){return K.OK})):Promise.resolve(K.FAIL)},hide:function(t){var e=function(t,e){var n=e.filter((function(e){return e.shipDTO.publicId===t}));return 0===n.length?null:n[0]}(t,n);return e?(e.displayHistory=!1,b(),Promise.resolve(K.OK)):Promise.resolve(K.FAIL)},initShipFetch:h.toggle}),Object(S.jsx)(C,{ships:n.map((function(t){return F.from(t)})),traces:d||[]})]}):Object(S.jsx)(j.b,{w:"100%",h:"100%",children:Object(S.jsx)(X,{onLogin:u.updateAuth})})})},q=(n(119),Object(h.b)({config:{initialColorMode:"dark",useSystemColorMode:!1}})),Q=function(){var t=Object(s.useState)("main"),e=Object(a.a)(t,2),n=e[0],c=e[1],i=Object(s.useState)(),r=Object(a.a)(i,2),o=r[0],u=r[1];return Object(S.jsx)(h.a,{theme:q,children:Object(S.jsxs)(D.Provider,{value:{auth:o,updateAuth:u},children:[Object(S.jsxs)(j.d,{w:"100vw",h:"70px",bg:"teal.600",spacing:0,fontSize:"28px",textAlign:"center",shadow:"0px 0px 10px 2px black",pos:"relative",zIndex:10,children:[Object(S.jsx)(j.e,{bg:"main"===n?"teal.700":"teal.600",px:8,h:"100%",onClick:function(){return c("main")},children:Object(S.jsx)(j.b,{h:"100%",children:"Ship Monitoring"})}),Object(S.jsx)(j.e,{bg:"my"===n?"teal.700":"teal.600",px:8,h:"100%",onClick:function(){return c("my")},children:Object(S.jsx)(j.b,{h:"100%",children:"My tracked Ships"})})]}),Object(S.jsx)(j.b,{w:"100vw",h:"calc(100vh - 70px)",children:"main"===n?Object(S.jsx)(M,{}):Object(S.jsx)($,{})})]})})},tt=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,132)).then((function(e){var n=e.getCLS,c=e.getFID,s=e.getFCP,i=e.getLCP,r=e.getTTFB;n(t),c(t),s(t),i(t),r(t)}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(Object(S.jsxs)(s.StrictMode,{children:[Object(S.jsx)(c.b,{}),Object(S.jsx)(Q,{})]}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()})).catch((function(t){console.error(t.message)})),tt()}},[[120,1,2]]]);
//# sourceMappingURL=main.6e6766f7.chunk.js.map